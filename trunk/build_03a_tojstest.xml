<project name="JSmol" default="toJsTest" basedir=".">
 
	<!-- builetojstest.xml just creates the site directory 
	     for testing using test.htm without any minimization -->

	<!-- you must have checked out and built the Jmol project prior to running this. -->
	
	
	  <property name="jmol.path" value="../Jmol" />
	  <property name="jsv.path" value="../JSpecView" />

   <target name="toJsTest" id="toJsTest">
  		
  	<echo>Deleting the site directory.</echo>
   	 	<delete quiet="true" dir="site" />

  	<echo>creating site/jsmol/j2s</echo>

   	<copy todir="site/jsmol/j2s/java" >
      <fileset dir="j2s/java">
        <include name="**/*.js" />
      </fileset>
    </copy>

    <copy overwrite="true" todir="site/jsmol/j2s/java" >
      <fileset dir="bin/java">
        <include name="**/*.js" />
      </fileset>
    </copy>

    <copy todir="site/jsmol/j2s/JZ" >
      <fileset dir="bin/com/jcraft/jzlib">
        <include name="**/*.js" />
      </fileset>
    </copy>
    
   	<copy todir="site/jsmol/j2s/J" >
      <fileset dir="bin/org/jmol">
        <include name="**/*.js" />
      </fileset>
    </copy>
   	
   	<copy todir="site/jsmol/j2s/JSV" >
      <fileset dir="bin/jspecview">
        <include name="**/*.js" />
      </fileset>
    </copy>
   	
   	<copy todir="site/jsmol/j2s/JU" >
      <fileset dir="bin/javajs/util">
        <include name="**/*.js" />
      </fileset>
    </copy>
   	
   	<copy todir="site/jsmol/j2s/javajs" >
      <fileset dir="bin/javajs">
        <include name="**/*.js" />
        <exclude name="**/util/*.js" />
      </fileset>
    </copy>

   	
  	<!-- modify class names -->		

    <echo>modifying class names "org.jmol" to "J"</echo>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="org.jmol" value="J"/>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="org/jmol" value="J"/>

    <echo>modifying class names "javajs.util" to "JU"</echo>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="javajs.util" value="JU"/>

  	<echo>modifying class names "com.jcraft.jzlib" to "JZ"</echo>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="com.jcraft.jzlib" value="JZ"/>
   	
  	<echo>modifying class names "jspecview" to "JSV"</echo>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="jspecview" value="JSV"/>
   	
    <echo>modifying class names "Clazz.defineMethod " to "$_M"</echo>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="Clazz.defineMethod " value="$_M"/>
   	  	
    <echo>modifying class names "Clazz.overrideMethod " to "$_V"</echo>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="Clazz.overrideMethod " value="$_V"/>
   	  	
	
   	  	
  	<!-- get version information  -->		
    <copy todir="site/jsmol/j2s" >
  	  <fileset dir="">
  	    <include name="Jmol.properties" />
  	  </fileset>
    </copy>
   	
    <copy todir="site/jsmol/j2s/J" >
  	  <fileset dir="">
  	    <include name="Jmol.properties" />
  	  </fileset>
    </copy>
   	

   	
   	<!-- get required non-JavaScript resources -->
   	
    <copy todir="site/jsmol/j2s/J/minimize/forcefield/data" >
      <fileset dir="${jmol.path}/src/org/jmol/minimize/forcefield/data">
        <include name="*.txt" />
      </fileset>
    </copy>
    <copy todir="site/jsmol/j2s/J/modelkit/images">
      <fileset dir="${jmol.path}/src/org/jmol/modelkit/images">
        <include name="*" />
      </fileset>
    </copy>

    <copy todir="site/jsmol/j2s/JSV/common" >
      <fileset dir="${jsv.path}">
        <include name="TODO.txt" />
      </fileset>
		  <filterchain>
		    <striplinecomments>
		      <comment value="#" />
		    </striplinecomments>
		    <linecontains>
		      <contains value="___" />
		    </linecontains>
		  </filterchain>
    </copy>
   	<echo>adding version information to JSVersion.js</echo>
   	<concat destfile="temp.js"><filelist dir="site/jsmol/j2s/JSV/common" files="
   		TODO.txt
   		JSVersion.js
   		" />
   	</concat>
  	<move file="temp.js" tofile="site/jsmol/j2s/JSV/common/JSVersion.js" />

  	<!-- get .po files from the Jmol project -->		
   	<copy overwrite="true" todir="site/jsmol/j2s/trans" >
	  <fileset dir="${jmol.path}/src/org/jmol/translation/JmolApplet">
	    <include name="*.po" />
	  </fileset>
	</copy>

   	<!-- add jspecview files and subdirectories -->

   		<copy todir="site/jsmol/j2s/JSV/export/resources" >
      <fileset dir="${jsv.path}/src/jspecview/export/resources">
        <include name="*.vm" />
      </fileset>
    </copy>

   	<!-- add jsmol files and subdirectories -->

   	<copy todir="site/jsmol">
  	  <fileset dir="html">
  	    <include name="**/*" />
  	  </fileset>
      <fileset dir="">
    	 <include name="README.TXT" />
      </fileset>
    </copy>
   	
   	<copy todir="site/jsmol/data">
  	  <fileset dir="data">
  	    <include name="t.jdx" />
  	    <include name="t2d.jdx" />
  	    <include name="caffeine.mol" />
  	    <include name="vinylpyrr.jdx" />
  	    <include name="acetophenone.jdx" />
  	  </fileset>
    </copy> 

  	<copy todir="site/jsmol/jquery">
  	  <fileset dir="lib/jquery">
  	    <include name="**/*" />
  	  </fileset>
    </copy>

  	<copy todir="site/jsmol/jsme">
  	  <fileset dir="lib/jsme">
  	    <include name="**/*" />
  	  </fileset>
    </copy>
	   	
   	<copy todir="site/jsmol/js">
  	  <fileset dir="jsmoljs">
  	    <include name="**/*" />
  	  </fileset>
    </copy> 
   	
   	<copy todir="site/jsmol/j2s/core">
  	  <fileset dir="${jmol.path}/srcjs/js">
  	    <include name="package.js" />
  	  </fileset>
    </copy>


	<concat destfile="site/jsmol/j2s/core/core.z.js"><filelist dir="site/jsmol/j2s" files="
   		../../../Jmol.properties
   		../../../jsmoljs/JSmolJavaExt.js
   	   	" />
   	</concat>   	

  	<echo>cleaning up files</echo>
  	<delete dir="jslocal" />
 	<delete file="temp.js" />
   	<echo>site directory created -- use test.htm</echo>
  </target>

</project>
