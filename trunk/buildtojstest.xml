<project name="JSmol" default="toJsTest" basedir=".">
 
	<!-- builetojstest.xml just creates the site directory 
	     for testing using test.htm without any minimization -->

	<!-- you must have checked out and built the Jmol project prior to running this. -->
	
	
	  <property name="jmol.path" value="../Jmol" />
	  <property name="jsv.path" value="../JSpecView" />

   <target name="toJsTest" id="toJsTest">
  			
 	<delete dir="site" />

  	<echo>creating site/jsmol/j2s</echo>
  	
   	<copy todir="site/jsmol/j2s/java" >
      <fileset dir="j2s/java">
        <include name="**/*.js" />
      </fileset>
    </copy>

    <copy overwrite="true" todir="site/jsmol/j2s/java" >
      <fileset dir="bin/java">
        <include name="**/*.js" />
      </fileset>
    </copy>

    <copy todir="site/jsmol/j2s/JZ" >
      <fileset dir="bin/com/jcraft/jzlib">
        <include name="**/*.js" />
      </fileset>
    </copy>
    
   	<copy todir="site/jsmol/j2s/J" >
      <fileset dir="bin/org/jmol">
        <include name="**/*.js" />
      </fileset>
    </copy>
   	
   	<copy todir="site/jsmol/j2s/JSV" >
      <fileset dir="bin/jspecview">
        <include name="**/*.js" />
      </fileset>
    </copy>
   	

    <echo>modifying class names</echo>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="org.jmol" value="J"/>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="org/jmol" value="J"/>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="com.jcraft.jzlib" value="JZ"/>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="src/J" value="src/org/jmol"/>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="jspecview" value="JSV"/>

  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="Clazz.defineMethod " value="$_M"/>
   	  	
  	<!-- get version information  -->		
    <copy todir="site/jsmol/j2s" >
  	  <fileset dir="">
  	    <include name="Jmol.properties" />
  	  </fileset>
    </copy>
   	
    <copy todir="site/jsmol/j2s/J" >
  	  <fileset dir="">
  	    <include name="Jmol.properties" />
  	  </fileset>
    </copy>
   	
  	<!-- get required non-JavaScript resources -->		
    <copy todir="site/jsmol/j2s/J/minimize/forcefield/data" >
      <fileset dir="${jmol.path}/src/org/jmol/minimize/forcefield/data">
        <include name="*.txt" />
      </fileset>
    </copy>
    <copy todir="site/jsmol/j2s/J/modelkit/images">
      <fileset dir="${jmol.path}/src/org/jmol/modelkit/images">
        <include name="*" />
      </fileset>
    </copy>

    <copy todir="site/jsmol/j2s/JSV/common" >
      <fileset dir="${jsv.path}">
        <include name="TODO.txt" />
      </fileset>
		  <filterchain>
		    <striplinecomments>
		      <comment value="#" />
		    </striplinecomments>
		    <linecontains>
		      <contains value="___" />
		    </linecontains>
		  </filterchain>
    </copy>

  	<!-- get .po files from the Jmol project -->		
   	<copy overwrite="true" todir="site/jsmol/j2s/trans" >
	  <fileset dir="${jmol.path}/src/org/jmol/translation/JmolApplet">
	    <include name="*.po" />
	  </fileset>
	</copy>

   	<!-- add jsmol files and subdirectories -->

   	<copy todir="site/jsmol">
  	  <fileset dir="html">
  	    <include name="**/*" />
  	  </fileset>
      <fileset dir="">
    	 <include name="README.TXT" />
      </fileset>
    </copy>
   	
   	<copy todir="site/jsmol/data">
  	  <fileset dir="data">
  	    <include name="**/*" />
  	  </fileset>
    </copy> 
   	
   	<copy todir="site/jsmol/flot">
  	  <fileset dir="lib/flot">
  	    <include name="**/*" />
  	  </fileset>
    </copy>
 	
  	<copy todir="site/jsmol/java">
  	  <fileset dir="${jmol.path}/build">
  	    <include name="JmolApplet*.jar" />
  	  </fileset>
	  <fileset dir="${jmol.path}/appletweb">
	    <include name="JSpecViewApplet*.jar" />
	  </fileset>
	</copy>

   	<copy todir="site/jsmol/jme">
  	  <fileset dir="lib/jme">
  	    <include name="**/*" />
  	  </fileset>
    </copy>

  	<copy todir="site/jsmol/jquery">
  	  <fileset dir="lib/jquery">
  	    <include name="**/*" />
  	  </fileset>
    </copy>

   	<copy todir="site/jsmol/jsme">
  	  <fileset dir="lib/jsme">
  	    <include name="**/*" />
  	  </fileset>
    </copy>
	   	
   	<copy todir="site/jsmol/js">
  	  <fileset dir="jsmoljs">
  	    <include name="**/*" />
  	  </fileset>
    </copy> 
   	
  	<copy todir="site/jsmol/php">
  	  <fileset dir="php">
  	    <include name="**/*" />
  	  </fileset>
    </copy>
     	
   	<copy todir="site/jsmol/j2s/core">
  	  <fileset dir="${jmol.path}/srcjs/js">
  	    <include name="package.js" />
  	  </fileset>
    </copy>


	<concat destfile="site/jsmol/j2s/core/core.z.js"><filelist dir="site/jsmol/j2s" files="
   		../../../Jmol.properties
   		../../../jsmoljs/core/coretop.js
   		../../../jsmoljs/core/corebottom.js
   	   	" />
   	</concat>   	

  	<echo>cleaning up files</echo>
  	<delete dir="jslocal" />
 	<delete file="temp.js" />
   	<echo>site directory created -- use test.htm</echo>
  </target>

</project>
