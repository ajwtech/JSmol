<project name="JSmol" default="toJs" basedir=".">
 
   <!-- you must have checked out and built the Jmol project prior to running this. -->
	
	
   <property name="jmol.path" value="../Jmol" />
   <property name="jsv.path" value="../JSpecView" />

   <target name="toJs" id="toJs">
  			
  	<!-- create a NON svn local directory only containing JS files  -->
  	
  	<echo>Deleting the site directory.</echo>
   	 	<delete quiet="true" dir="site" />

   	<echo>creating site/jsmol/j2s</echo>

   	<copy todir="site/jsmol/j2s/java" >
      <fileset dir="j2s/java">
        <include name="**/*.js" />
      </fileset>
    </copy>

    <copy overwrite="true" todir="site/jsmol/j2s/java" >
      <fileset dir="bin/java">
        <include name="**/*.js" />
      </fileset>
    </copy>

    <copy todir="site/jsmol/j2s/JZ" >
      <fileset dir="bin/com/jcraft/jzlib">
        <include name="**/*.js" />
      </fileset>
    </copy>
    
   	<copy todir="site/jsmol/j2s/J" >
      <fileset dir="bin/org/jmol">
        <include name="**/*.js" />
      </fileset>
    </copy>
   	
   	<copy todir="site/jsmol/j2s/JSV" >
      <fileset dir="bin/jspecview">
        <include name="**/*.js" />
      </fileset>
    </copy>
   	
   	<copy todir="site/jsmol/j2s/JU" >
      <fileset dir="bin/javajs/util">
        <include name="**/*.js" />
      </fileset>
    </copy>
   	
   	<copy todir="site/jsmol/j2s/javajs" >
      <fileset dir="bin/javajs">
        <include name="**/*.js" />
        <exclude name="**/util	/*.js" />
      </fileset>
    </copy>

   	
  	<!-- modify class names -->		

    <echo>abbreviating class names "org.jmol" to "J"</echo>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="org.jmol" value="J"/>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="org/jmol" value="J"/>

    <echo>abbreviating class names "javajs.util" to "JU"</echo>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="javajs.util" value="JU"/>

  	<echo>abbreviating class names "com.jcraft.jzlib" to "JZ"</echo>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="com.jcraft.jzlib" value="JZ"/>
   	
  	<echo>modifying class names "jspecview" to "JSV"</echo>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="jspecview" value="JSV"/>
    <echo>abbreviating method names "Clazz.defineMethod " to "$_M"</echo>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="Clazz.defineMethod " value="$_M"/>
    <echo>abbreviating method names "Clazz.overrideMethod " to "$_V"</echo>
  	<replace dir="site/jsmol/j2s" includes="**/*.js" token="Clazz.overrideMethod " value="$_V"/>
   	  	
   	  	
  	<!-- get version information  -->		
    <copy todir="site/jsmol/j2s" >
  	  <fileset dir="">
  	    <include name="Jmol.properties" />
  	  </fileset>
    </copy>
   	
   	<copy todir="site/jsmol/j2s/J" >
  	  <fileset dir="">
  	    <include name="Jmol.properties" />
  	  </fileset>
    </copy>
   	
  	<!-- get required non-JavaScript resources -->		
    <copy todir="site/jsmol/j2s/J/minimize/forcefield/data" >
      <fileset dir="${jmol.path}/src/org/jmol/minimize/forcefield/data">
        <include name="*.txt" />
      </fileset>
    </copy>
    <copy todir="site/jsmol/j2s/J/quantum" >
      <fileset dir="${jmol.path}/src/org/jmol/quantum">
        <include name="*.txt" />
      </fileset>
    </copy>
    <copy todir="site/jsmol/j2s/J/modelkit/images">
      <fileset dir="${jmol.path}/src/org/jmol/modelkit/images">
        <include name="*" />
      </fileset>
    </copy>
   	   	
    <copy todir="site/jsmol/j2s/JSV/common" >
      <fileset dir="${jsv.path}">
        <include name="TODO.txt" />
      </fileset>
		  <filterchain>
		    <striplinecomments>
		      <comment value="#" />
		    </striplinecomments>
		    <linecontains>
		      <contains value="___" />
		    </linecontains>
		  </filterchain>
    </copy>
   	<echo>adding version information to JSVersion.js</echo>
   	<concat destfile="temp.js"><filelist dir="site/jsmol/j2s/JSV/common" files="
   		TODO.txt
   		JSVersion.js
   		" />
   	</concat>
  	<move file="temp.js" tofile="site/jsmol/j2s/JSV/common/JSVersion.js" />

  	<!-- get .po files from the Jmol project -->		
   	<echo>adding .po files</echo>
   	<copy overwrite="true" todir="site/jsmol/idioma" >
	  <fileset dir="${jmol.path}/src/org/jmol/translation/JmolApplet">
	    <include name="*.po" />
	  </fileset>
	</copy>


   	<!-- add jspecview files and subdirectories -->

   	<echo>adding JSV/export/resources files</echo>
   		<copy todir="site/jsmol/j2s/JSV/export/resources" >
      <fileset dir="${jsv.path}/src/jspecview/export/resources">
        <include name="*.vm" />
      </fileset>
    </copy>

   	<!-- add jsmol files and subdirectories -->

   	<echo>adding html files</echo>
   	<copy todir="site/jsmol">
  	  <fileset dir="html">
  	    <include name="**/*" />
  	  </fileset>
      <fileset dir="">
    	 <include name="README-DOWNLOAD.TXT" />
      </fileset>
    </copy>

   	<echo>adding data files</echo>
   	<copy todir="site/jsmol/data">
  	  <fileset dir="data">
  	    <include name="**/*" />
  	  </fileset>
    </copy> 
   	
   	<echo>adding flot</echo>
   	<copy todir="site/jsmol/flot">
  	  <fileset dir="lib/flot">
  	    <include name="**/*" />
  	  </fileset>
    </copy>
 	
 	<echo>adding Jmol and JSpecView jar and jnlp files</echo>
  	<copy todir="site/jsmol/java">
  	  <fileset dir="${jmol.path}/build">
  	    <include name="JmolApplet*.jar" />
  	  </fileset>
  	  <fileset dir="${jsv.path}/build">
  	    <include name="JSpecViewApplet*.jar" />
  	  </fileset>
     	  <fileset dir="jnlp">
          <include name="*.jnlp" />
       </fileset>
   	  <fileset dir="jnlp">
        <include name="*.jnlp" />
     </fileset>
	</copy>
		
   	<echo>adding jQuery and minimizing it</echo>
  	<copy todir="site/jsmol/jquery">
  	  <fileset dir="lib/jquery">
  	    <include name="**/*" />
  	  </fileset>
    </copy>

   	<java jar="jars/closure_compiler.jar" fork="true" dir="site/jsmol/jquery" failonerror="false">
   		<arg line="--js jquery.js --js_output_file jquery.min.js" />
    </java>

   	<echo>adding jsme</echo>
  	<copy todir="site/jsmol/jsme">
  	  <fileset dir="lib/jsme">
  	    <include name="**/*" />
  	  </fileset>
    </copy>
	   	
   	<echo>adding js subdirectory</echo>
   	<copy todir="site/jsmol/js">
  	  <fileset dir="jsmoljs">
  	    <include name="**/*" />
  	  </fileset>
    </copy> 
   	
   	<echo>adding spt subdirectory</echo>
   	<copy todir="site/jsmol/spt">
  	  <fileset dir="spt">
  	    <include name="**/*" />
  	  </fileset>
    </copy> 
   	
   	<echo>adding jsmol.php</echo>
  	<copy todir="site/jsmol/php">
  	  <fileset dir="php">
  	    <include name="**/*" />
  	  </fileset>
    </copy>
  
   	<echo>adding j2s/img subdirectory</echo>
  	<copy todir="site/jsmol/j2s/img">
  	  <fileset dir="img">
  	    <include name="**/*" />
  	  </fileset>
    </copy>
   	
   	<!-- make core files -->
 
   	<echo>adding package.js from ${jmol.path}/srcjs/js</echo>
   	<copy todir="site/jsmol/j2s/core">
  	  <fileset dir="${jmol.path}/srcjs/js">
  	    <include name="package.js" />
  	  </fileset>
    </copy>


   	<!-- note: any changes in these next sections must be reflected also
   	             in package.js -->
   	
   	<echo>creating and compressing core files - warnings are OK; "does not exist" is trouble</echo>
   	
    <antcall target="call-core">
        <param name="call-core.name" value="" />
        <param name="call-core.list" value="
       		../../../Jmol.properties
       		../js/JSmolJavaExt.js
       		../js/core/coretop.js
       		JU/T3.js
       		JU/T3i.js
       		JU/T3d.js
       		JU/P3.js
       		JU/P3i.js
       		JU/V3.js
       		JU/V3d.js
       		JU/M3.js
       		JU/T4.js
       		JU/P4.js
       		JU/M4.js
       		JU/A4.js
       		JU/BS.js
       		JU/SB.js
    		JU/DF.js
       		JU/PT.js
       		JU/AU.js
       		java/util/MapEntry.js
       		java/util/Dictionary.js
       		java/util/AbstractCollection.js
       		java/lang/AbstractStringBuilder.js
       		java/lang/StringBuilder.js
       		java/lang/StringBuffer.js
       		java/util/AbstractList.js
       		java/util/ArrayList.js
       		JU/List.js
       		JU/CU.js
       		javajs/api/FontManager.js
       		javajs/api/GenericMenuInterface.js
       		javajs/api/ZInputStream.js
       		javajs/awt/Font.js
       		java/net/Parts.js
       		java/util/AbstractSet.js
       		java/util/Arrays.js
       		java/util/AbstractMap.js
       		java/util/SortedMap.js
       		java/util/SortedSet.js
       		java/util/Collections.js
       		java/util/Hashtable.js
       		javajs/awt/Dimension.js
       		java/io/InputStream.js
       		java/io/ByteArrayInputStream.js
       		java/io/FilterInputStream.js
       		java/io/BufferedInputStream.js
       		java/io/Reader.js
       		java/io/InputStreamReader.js
       		java/io/BufferedReader.js
       		java/io/StringReader.js
       		java/io/OutputStream.js
    		java/io/ByteArrayOutputStream.js
       		java/net/MalformedURLException.js
       		java/net/URLEncoder.js
       		java/net/URLDecoder.js
       		java/net/URLStreamHandlerFactory.js
       		java/net/URLStreamHandler.js
       		java/net/URL.js
       		java/net/URLConnection.js
       		JU/AjaxURLConnection.js
       		JU/AjaxURLStreamHandlerFactory.js
       		JU/AjaxURLStreamHandler.js
       		java/text/MessageFormat.js
       		java/util/Random.js
       		J/util/LoggerInterface.js
       		J/util/DefaultLogger.js
       		J/util/Logger.js
       		J/i18n/Resource.js
       		J/i18n/Language.js
       		J/i18n/GT.js
       		J/api/JmolAppConsoleInterface.js
       		J/api/JmolDocument.js
       		J/api/JmolCallbackListener.js
       		J/api/JmolStatusListener.js
       		J/api/JmolSyncInterface.js
    		J/api/JmolModulationSet.js
    		J/api/JmolAppletInterface.js
        	J/util/GenericApplet.js
        	J/appletjs/Jmol.js
       		java/lang/Enum.js
       		J/constant/EnumCallback.js
       		J/util/Escape.js
       		J/util/Parser.js
       		J/util/Txt.js
       		J/script/T.js
       		J/util/BSUtil.js
       		J/util/JmolEdge.js
       		J/modelset/BondSet.js
       		J/modelset/Bond.js
       		J/util/Measure.js
       		J/script/SV.js
       		JU/Encoding.js
       		java/util/Properties.js
       		J/util/Elements.js
       		J/util/Vibration.js
       		J/viewer/JC.js
       		J/util/Int2IntHash.js
       		J/util/C.js
       		J/util/Quaternion.js
       		J/constant/EnumPalette.js
       		J/util/Shader.js
       		J/api/JmolViewer.js
       		J/atomdata/AtomDataServer.js
       		J/constant/EnumVdw.js
       		J/atomdata/RadiusData.js
       		J/util/CommandHistory.js
    		javajs/api/JSInterface.js
       		J/viewer/Viewer.js
       		java/lang/Thread.js
       		J/constant/EnumQuantumShell.js
       		J/api/JmolAdapter.js
       		J/adapter/smarter/SmarterJmolAdapter.js
       		J/api/Interface.js
       		java/lang/ThreadGroup.js
       		J/constant/EnumAxesMode.js
       		J/constant/EnumFileStatus.js
       		J/api/JmolAdapterAtomIterator.js
       		J/adapter/smarter/AtomIterator.js
       		J/adapter/smarter/AtomSetCollection.js
       		J/api/JmolAdapterBondIterator.js
       		J/adapter/smarter/BondIterator.js
       		J/adapter/smarter/Resolver.js
       		J/api/JmolAdapterStructureIterator.js
       		J/adapter/smarter/StructureIterator.js
       		J/modelset/Group.js
       		J/adapter/smarter/Atom.js
       		J/adapter/smarter/AtomSetObject.js
       		J/adapter/smarter/Bond.js
       		J/constant/EnumStructure.js
       		java/util/StringTokenizer.js
       		J/adapter/smarter/AtomSetCollectionReader.js
       		J/thread/JmolThread.js
       		J/io/LimitedLineReader.js
       		J/constant/EnumStereoMode.js
       		JU/Base64.js
       		J/io/CifDataReader.js
       		J/io/JmolBinary.js
      		J/shape/Shape.js
    		javajs/api/BytePoster.js
       		J/viewer/FileManager.js
       		J/script/ContextToken.js
       		J/script/ScriptContext.js
       		J/constant/EnumAnimationMode.js
       		J/io/FileReader.js
       		J/util/JmolNode.js
       		J/util/Point3fi.js
       		J/modelset/Atom.js
       		J/modelset/AtomCollection.js
       		J/modelset/LabelToken.js
       		J/api/JmolMeasurementClient.js
       		J/modelset/MeasurementData.js
       		J/util/BoxInfo.js
       		J/modelset/BondCollection.js
    		J/modelset/StateScript.js
       		J/modelset/ModelCollection.js
       		J/atomdata/AtomData.js
       		J/modelset/Measurement.js
       		J/util/Geodesic.js
       		J/util/Normix.js
       		J/modelset/BondIterator.js
       		J/modelset/BondIteratorSelected.js
       		J/modelset/HBond.js
     		J/bspt/Bspf.js
       		J/io/XmlUtil.js
       		J/api/AtomIndexIterator.js
       		J/modelset/AtomIteratorWithinModel.js
       		J/modelset/AtomIteratorWithinModelSet.js
       		J/bspt/Bspt.js
       		J/util/JmolMolecule.js
       		J/modelset/TickInfo.js
       		J/script/ScriptException.js
       		J/bspt/CubeIterator.js
       		J/bspt/Element.js
       		J/bspt/Leaf.js
       		J/util/ColorEncoder.js
       		J/api/JmolGraphicsInterface.js
       		J/util/GData.js
       		J/bspt/Node.js
       		J/util/MeshSurface.js
       		J/util/Rectangle.js
       		J/viewer/MouseState.js
    		javajs/api/EventManager.js
       		J/viewer/ActionManager.js
    		J/Viewer/GlobalSettings.js
    		J/modelset/Orientation.js
       		J/viewer/StateManager.js
       		J/modelset/MeasurementPending.js
       		J/thread/HoverWatcherThread.js
       		J/viewer/binding/Binding.js
       		J/viewer/binding/DragBinding.js
       		J/viewer/binding/JmolBinding.js
       		J/thread/TimeoutThread.js
       		J/util/TempArray.js
       		J/viewer/AnimationManager.js
       		J/viewer/ColorManager.js
       		J/viewer/ShapeManager.js
       		J/viewer/ModelManager.js
       		J/viewer/SelectionManager.js
       		J/viewer/StatusManager.js
       		J/viewer/TransformManager.js
       		J/modelset/ModelLoader.js
       		J/viewer/TransformManager11.js
       		J/modelset/Chain.js
       		J/modelset/Model.js
       		J/modelset/ModelSet.js
       		javajs/api/PlatformViewer.js
       		javajs/api/GenericPlatform.js
       		J/awtjs2d/Platform.js
       		J/awtjs2d/Display.js
       		J/awtjs2d/JSFont.js
       		J/awtjs2d/Image.js
       		javajs/api/GenericFileInterface.js
       		J/awtjs2d/JSFile.js
       		javajs/api/GenericMouseInterface.js
       		javajs/awt/event/Event.js
       		J/awtjs2d/Mouse.js
       		J/api/JmolNavigatorInterface.js
       		J/api/JmolRendererInterface.js
       		J/g3d/Graphics3D.js
       		J/g3d/SphereRenderer.js
       		J/g3d/CylinderRenderer.js
       		J/g3d/ImageRenderer.js
       		J/g3d/LineRenderer.js
       		J/g3d/Pixelator.js
       		J/g3d/PixelatorShaded.js
       		J/g3d/Platform3D.js
       		J/g3d/TextRenderer.js
       		J/g3d/TextSorter.js
       		J/g3d/TextString.js
       		J/util/Rgb16.js
    		J/g3d/G3DRenderer.js
       		J/g3d/TriangleRenderer.js
       		J/api/JmolRepaintManager.js
       		J/render/RepaintManager.js
       		J/shape/AtomShape.js
       		J/shape/Balls.js
       		J/shape/Sticks.js
       		J/shape/FontShape.js
       		J/shape/FontLineShape.js
       		J/shape/Frank.js
       		J/render/ShapeRenderer.js
       		J/render/BallsRenderer.js
       		J/render/FontLineShapeRenderer.js
       		J/render/SticksRenderer.js
       		J/util/SimpleUnitCell.js
       		J/render/FrankRenderer.js
       		J/adapter/readers/molxyz/MolReader.js
       		J/adapter/readers/molxyz/XyzReader.js
       		J/awtjs/Platform.js
       		J/awtjs/JSFont.js
       		J/awtjs/Image.js
       		../js/core/corebottom.js
        	" />
    </antcall>

    <antcall target="call-core">
        <param name="call-core.name" value="jsv" />
        <param name="call-core.list" value="
       		../../../Jmol.properties
       		../js/JSmolJavaExt.js
       		../js/core/coretop.js
       	JSV/api/JSVAppletInterface.js
       	JSV/api/AppletFrame.js
   	JSV/appletjs/JSVApplet.js
           	JSV/appletjs/JSVAppletPro.js
       	JSV/api/ScriptInterface.js
       	JSV/api/JSVAppInterface.js
       	JSV/api/PanelListener.js
   	JSV/app/JSVApp.js
   	JSV/common/JSVersion.js
       	JSV/api/JSVPanel.js 
   	JSV/js2d/JsPanel.js
       	JSV/api/JSVMainPanel.js 
       	JSV/api/JSVViewPanel.js 
   	JSV/js2d/JsViewPanel.js
       	JSV/common/CoordComparator.js
   	JSV/common/Coordinate.js
   	JSV/common/JSVFileManager.js
       	JSV/source/JDXHeader.js
       	JSV/source/JDXDataObject.js
       	JSV/common/JDXSpectrum.js
   	JSV/common/JSViewer.js
   	JSV/common/PanelNode.js
   	JSV/common/Parameters.js
   	JSV/util/JSVEscape.js
   	JU/OC.js
   	JSV/common/Annotation.js
   	JSV/common/ExportType.js
   	JSV/common/PanelData.js
   	JSV/common/ScriptToken.js
   	JSV/common/PeakInfo.js
   	JSV/source/JDXSourceStreamTokenizer.js
       	java/io/Writer.js
   	java/io/BufferedWriter.js
   	JSV/api/JSVGraphics.js
   	JSV/common/ScriptTokenizer.js
       	JSV/common/Measurement.js
   	JSV/common/Integral.js
   	JSV/exception/JSpecViewException.js
       	JSV/dialog/JSVDialog.js
       	JSV/api/XYScaleConverter.js
   	JSV/common/GraphSet.js
       	JSV/api/AnnotationData.js
   	JSV/common/MeasurementData.js
   	JSV/common/PeakPickEvent.js
   	JSV/common/SubSpecChangeEvent.js
   	JSV/common/ZoomEvent.js
   	JSV/common/ColorParameters.js
   	JSV/common/ColoredAnnotation.js
   	JSV/common/ImageView.js
       	JSV/common/IntegralComparator.js
   	JSV/common/IntegralData.js
   	JSV/common/PeakData.js
   	JSV/common/PlotWidget.js
   	JSV/common/ScaleData.js
   	JSV/common/ViewData.js
   	JSV/common/PrintLayout.js
   	JSV/common/PeakPick.js
   	JSV/common/RepaintManager.js
   	JSV/source/JDXSource.js
       	JSV/api/JSVTree.js
   	JSV/tree/SimpleTree.js
   	JSV/source/FileReader.js
   	JSV/common/PDFWriter.js
   	JSV/tree/SimpleTreeModel.js
       	JSV/api/JSVTreeNode.js
   	JSV/tree/SimpleTreeNode.js
       	JSV/api/JSVTreePath.js
   	JSV/tree/SimpleTreePath.js
   	JSV/api/JSVZipReader.js
   	JSV/exception/JDXSourceException.js
   	JSV/source/JDXDecompressor.js
   	javajs/export/PDFCreator.js
   	JSV/tree/SimpleTreeEnumeration.js
   	javajs/export/PDFObject.js
       	JZ/Deflater.js
   	java/util/zip/Deflater.js
       	java/io/FilterOutputStream.js
       	JZ/DeflaterOutputStream.js
   	java/util/zip/DeflaterOutputStream.js
   	JZ/Deflate.js
   	JSV/js2d/JsPlatform.js
   	JSV/js2d/Display.js
   	JSV/js2d/Image.js
   	JSV/js2d/JsFile.js
   	JSV/js2d/JsFont.js
   	JSV/js2d/Mouse.js
   	JSV/js2d/JsG2D.js
   	javajs/awt/Color.js
   	javajs/api/GenericColor.js
   	JSV/js2d/JsParameters.js
   	JSV/js2d/JsFileHelper.js
   	JSV/api/JSVFileHelper.js
       		../js/core/corebottom.js
    	" />
</antcall>

   	   	
   	<!-- minimize JSmol JavaScript -->
   	
   	<echo>JSmol.min.js is the standard set, including jQuery</echo>
    <antcall target="call-min">
        <param name="call-min.fullname" value="full" />
        <param name="call-min.minname" value="min" />
        <param name="call-min.list" value="
       		../lib/jquery/jquery.js
       		JSmoljQueryExt.js
       		JSmolCore.js
      		JSmolDebugOff.js
       		JSmol.js
       		JSmolApplet.js
       		JSmolControls.js
       		JSmolApi.js
       		j2sjmol.js
       		../Jmol.properties
        " />
    </antcall>

   	<echo>Continuing to create j2s/core files</echo>

    <antcall target="call-core">
        <param name="call-core.name" value="script" />
        <param name="call-core.list" value="
       		J/api/JmolScriptManager.js
       		J/api/JmolScriptEvaluator.js
    		J/api/JmolScriptFunction.js
    		J/api/JmolParallelProcessor.js
       		J/script/FileLoadThread.js
       		J/script/ScriptQueueThread.js
       		J/script/ScriptDelayThread.js
       		J/script/CommandWatcherThread.js
       		J/script/ScriptManager.js
       		J/script/ScriptEvaluator.js
       		J/script/ScriptCompiler.js
       		J/script/ScriptCompilationTokenParser.js
       		J/script/ScriptFlowContext.js
       		J/script/ScriptFunction.js
       		J/script/ScriptInterruption.js
       		J/script/ScriptMathProcessor.js
        	" />
    </antcall>

    <antcall target="call-core">
        <param name="call-core.name" value="script2" />
        <param name="call-core.list" value="
       		J/script/JmolScriptExtension.js
       		J/scriptext/ScriptExt.js
        	" />
    </antcall>

    <antcall target="call-core">
        <param name="call-core.name" value="state" />
        <param name="call-core.list" value="
       		J/viewer/JmolStateCreator.js
       		J/viewer/StateCreator.js
        	" />
    </antcall>

    <antcall target="call-core">
        <param name="call-core.name" value="prop" />
        <param name="call-core.list" value="
       		J/api/JmolPropertyManager.js
       		J/viewer/PropertyManager.js   	   	
        	" />
    </antcall>
   	
    <antcall target="call-core">
        <param name="call-core.name" value="console" />
        <param name="call-core.list" value="
       		../js/JSmolConsole.js
       		J/console/GenericTextArea.js
       		J/console/GenericConsole.js
       		J/consolejs/AppletConsole.js   	   	  	   	
        	" />
    </antcall>
   	
    <antcall target="call-core">
        <param name="call-core.name" value="menu" />
        <param name="call-core.list" value="
       		../js/JSmolMenu.js
       		J/popup/JmolAbstractMenu.js
       		J/popup/GenericPopup.js
       		J/awtjs2d/JSPopup.js
       		J/awtjs2d/JSmolPopup.js
       		J/popup/PopupResource.js
       		J/popup/MainPopupResourceBundle.js
        	" />
    </antcall>
   	
    <antcall target="call-core">
        <param name="call-core.name" value="min" />
        <param name="call-core.list" value="
       		J/api/MinimizerInterface.js
       		J/minimize/Minimizer.js
       		J/minimize/MinObject.js
       		J/minimize/MinAngle.js
       		J/minimize/MinAtom.js
       		J/minimize/MinBond.js
       		J/minimize/MinTorsion.js
       		J/minimize/Util.js
       		J/minimize/forcefield/AtomType.js
       		J/minimize/forcefield/ForceField.js
       		J/minimize/forcefield/ForceFieldMMFF.js
       		J/minimize/forcefield/ForceFieldUFF.js
       		J/minimize/forcefield/Calculation.js
       		J/minimize/forcefield/Calculations.js
       		J/minimize/forcefield/CalculationsMMFF.js
       		J/minimize/forcefield/CalculationsUFF.js
       		J/minimize/forcefield/FFParam.js
       		J/minimize/MinimizationThread.js
        	" />
    </antcall>
   	
    <antcall target="call-core">
        <param name="call-core.name" value="zip" />
        <param name="call-core.list" value="
       		J/api/JmolZipUtility.js
       		J/io2/ZipUtil.js
       		java/io/FileInputStream.js
       		JZ/Checksum.js
       		JZ/CRC32.js
       		java/util/zip/CRC32.js
       		JZ/InflaterInputStream.js
       		java/util/zip/InflaterInputStream.js
       		java/util/zip/GZIPInputStream.js
       		JZ/ZStream.js
       		JZ/Inflater.js
       		JZ/Adler32.js
       		JZ/Tree.js
       		JZ/StaticTree.js
       		JZ/GZIPHeader.js
       		JZ/Inflate.js
       		JZ/InfTree.js
       		JZ/InfBlocks.js
       		JZ/InfCodes.js
       		java/util/zip/CheckedInputStream.js
       		java/util/zip/Inflater.js
       		java/util/zip/ZipException.js
       		java/util/zip/ZipConstants.js
       		java/util/zip/ZipEntry.js
       		java/util/zip/ZipConstants64.js
       		java/util/zip/ZipInputStream.js
       		java/io/PushbackInputStream.js
       		J/io2/JmolZipInputStream.js
        	" />
    </antcall>
   	
    <antcall target="call-core">
        <param name="call-core.name" value="bio" />
        <param name="call-core.list" value="
       		J/adapter/readers/pdb/PdbReader.js
       		J/adapter/smarter/Structure.js
       		J/api/JmolBioResolver.js
       		J/modelsetbio/Resolver.js
       		J/modelsetbio/Monomer.js
       		J/modelsetbio/AlphaMonomer.js
       		J/modelsetbio/ProteinStructure.js
       		J/modelsetbio/Helix.js
       		J/modelsetbio/Sheet.js
       		J/modelsetbio/Turn.js
       		J/modelsetbio/BioPolymer.js
       		J/modelsetbio/AlphaPolymer.js
       		J/modelsetbio/AminoMonomer.js
       		J/modelsetbio/AminoPolymer.js
       		J/modelsetbio/BioModel.js
       		J/modelsetbio/CarbohydrateMonomer.js
       		J/modelsetbio/CarbohydratePolymer.js
       		J/modelsetbio/PhosphorusMonomer.js
       		J/modelsetbio/NucleicMonomer.js
       		J/modelsetbio/NucleicPolymer.js
       		J/modelsetbio/PhosphorusPolymer.js
       		J/dssx/Bridge.js
        	J/api/DSSPInterface.js
       		J/dssx/DSSP.js        	
        	J/shapebio/BioShape.js
       		J/shapebio/BioShapeCollection.js
       		J/shapebio/Rockets.js
       		J/shapebio/Cartoon.js
       		J/shapebio/Backbone.js
       		J/shapebio/Strands.js
       		J/shapebio/Ribbons.js
       		J/shapebio/MeshRibbon.js
       		J/shapebio/Trace.js
       		J/renderbio/BioShapeRenderer.js
       		J/renderbio/StrandsRenderer.js
       		J/renderbio/RibbonsRenderer.js
       		J/renderbio/MeshRibbonRenderer.js
       		J/renderbio/RocketsRenderer.js
       		J/renderbio/CartoonRenderer.js
       		J/renderbio/BackboneRenderer.js
       		J/renderbio/TraceRenderer.js
        	" />
    </antcall>
   	
    <antcall target="call-core">
        <param name="call-core.name" value="surface" />
        <param name="call-core.list" value="
       		J/api/VolumeDataInterface.js
       		J/jvxl/api/VertexDataServer.js
       		J/jvxl/api/MeshDataServer.js
       		J/shapesurface/Isosurface.js
       		J/jvxl/data/JvxlCoder.js
       		J/jvxl/data/VolumeData.js
       		J/jvxl/data/JvxlData.js
       		J/jvxl/data/MeshData.js
       		J/jvxl/readers/XmlReader.js
       		J/jvxl/readers/SurfaceGenerator.js
       		J/jvxl/readers/Parameters.js
       		J/jvxl/readers/SurfaceReader.js
       		J/jvxl/calc/MarchingCubes.js
       		J/jvxl/calc/MarchingSquares.js
       		J/shapesurface/IsosurfaceMesh.js
       		J/jvxl/readers/VolumeDataReader.js
       		J/jvxl/readers/AtomDataReader.js
       		J/jvxl/readers/IsoSolventReader.js
       		J/jvxl/readers/SurfaceFileReader.js
       		J/jvxl/readers/VolumeFileReader.js
       		J/jvxl/readers/JvxlXmlReader.js
       		J/rendersurface/IsosurfaceRenderer.js
        	" />
    </antcall>
   	
    <antcall target="call-core">
        <param name="call-core.name" value="sym" />
        <param name="call-core.list" value="
       		J/api/SymmetryInterface.js
       		J/symmetry/Symmetry.js
       		J/symmetry/PointGroup.js
       		J/symmetry/SpaceGroup.js
       		J/symmetry/HallInfo.js
       		J/symmetry/HallRotationTerm.js
       		J/symmetry/HallRotation.js
       		J/symmetry/HallTranslation.js
       		J/symmetry/SymmetryOperation.js
       		J/symmetry/SymmetryInfo.js
       		J/symmetry/UnitCell.js
        	" />
    </antcall>

    <antcall target="call-core">
        <param name="call-core.name" value="binary" />
        <param name="call-core.list" value="
       		java/io/PushbackInputStream.js
       		java/io/DataInputStream.js
       		JU/BC.js
       		J/io2/BinaryDocument.js
        	" />
    </antcall>
   	
   	
    <antcall target="call-core">
        <param name="call-core.name" value="pymol" />
        <param name="call-core.list" value="
       		J/api/JmolSceneGenerator.js
       		J/adapter/readers/pymol/PickleReader.js
       		J/api/PymolAtomReader.js
       		J/adapter/readers/pymol/PyMOL.js
       		J/adapter/readers/pymol/JmolObject.js
       		J/adapter/readers/pymol/PyMOLGroup.js
       		J/adapter/readers/pymol/PyMOLScene.js
       		J/adapter/readers/pymol/PyMOLReader.js
        	" />
    </antcall>

   	
    <antcall target="call-core">
        <param name="call-core.name" value="text" />
        <param name="call-core.list" value="
       		J/modelset/Object2d.js
       		J/modelset/Text.js
       		J/shape/Object2dShape.js
       		J/shape/TextShape.js
       		J/shape/Labels.js
       		J/shape/Echo.js
       		J/shape/Hover.js
       		J/render/TextRenderer.js
       		J/render/LabelsRenderer.js
       		J/render/EchoRenderer.js
       		J/render/HoverRenderer.js
        	" />
    </antcall>

   	
    <antcall target="call-core">
        <param name="call-core.name" value="smiles" />
        <param name="call-core.list" value="
   		J/smiles/VTemp.js
   		J/api/SmilesMatcherInterface.js
   		J/smiles/SmilesMatcher.js
   		J/smiles/InvalidSmilesException.js
   		J/smiles/SmilesSearch.js
   		J/smiles/SmilesGenerator.js
   		J/smiles/SmilesAromatic.js
   		J/smiles/SmilesAtom.js
   		J/smiles/SmilesBond.js
   		J/smiles/SmilesMeasure.js
   		J/smiles/SmilesParser.js
    	" />
    </antcall>

   	<!-- minimize additional JSmol JavaScript -->

   	<echo>JSmol.min.nojq.js is the standard set but does not include jQuery</echo>
    <antcall target="call-min">
        <param name="call-min.fullname" value="nojq" />
        <param name="call-min.minname" value="min.nojq" />
        <param name="call-min.list" value="
       	../Jmol.properties
   		JSmoljQueryExt.js
   		JSmolCore.js
   		JSmolDebugOff.js
   		JSmol.js
   		JSmolApplet.js
   		JSmolControls.js
   		JSmolApi.js
   		j2sjmol.js
   		" />
    </antcall>
   	<!--
   	   	<echo>JSmol.min.core.js includes JSmol.min.js and core.z.js</echo>
   	   	<concat destfile="site/jsmol/JSmol.min.core.js"><filelist dir="site/jsmol" files="
   	   		JSmol.min.js
   	   		j2s/core/core.z.js 
   	   		" />
   	   	</concat>
   	-->

   	<echo>JSmol.lite.js is a very minimal non-Jmol viewer; includes jQuery</echo>
    <antcall target="call-min">
        <param name="call-min.fullname" value="full.lite" />
        <param name="call-min.minname" value="lite" />
        <param name="call-min.list" value="
       		../lib/jquery/jquery.js
       		JSmoljQueryExt.js
      		JSmolCore.js
       		JSmolDebugOff.js
      		JSmolTM.js
   		" />
    </antcall>
   	
   	<echo>JSmol.lite.nojq.js is a very minimal non-Jmol viewer, without jQuery</echo>
    <antcall target="call-min">
        <param name="call-min.fullname" value="full.lite.nojq" />
        <param name="call-min.minname" value="lite.nojq" />
        <param name="call-min.list" value="
       		JSmoljQueryExt.js
      		JSmolCore.js
       		JSmolDebugOff.js
      		JSmolTM.js
   		" />
    </antcall>
   	
   	<echo>cleaning up files</echo>
   	<echo>creating distribution zip file jsmol.zip and copying it to Jmol</echo>
  	<delete file="dist/*" />
 	<delete file="temp.js" />
    <zip zipfile="dist/jsmol.zip" basedir="site" includes="**" />
   	<copy file="README-DOWNLOAD.TXT" tofile="dist/README.txt" />
   	<copy file="dist/jsmol.zip" tofile="${jmol.path}/appletweb/jsmol.zip" />
<!-- no longer necessary
   <zip zipfile="${jmol.path}/appletfiles/jsmol_nojars.zip">
	  <fileset dir="site">
	    <include name="**/*" />
	    <exclude name="**/*.jar" />
	  </fileset>
    </zip>
 -->
   	<echo>dist/jsmol.zip and ${jmol.path}/appletweb/jsmol.zip have been updated. 
   		site/jsmol is available for testing</echo>
<!--   	<echo>run  ${jmol.path}/buildjsmolzip.xml to finish the build. </echo> -->
  </target>

  <target name="call-core" id="call-core">
   	<echo>Creating core${call-core.name}.js</echo> 	
   	<concat destfile="site/jsmol/js/core${call-core.name}.js">
   		<filelist dir="site/jsmol/j2s" files="${call-core.list}" />
   	</concat> 
  	<copy file="site/jsmol/js/core${call-core.name}.js" tofile="site/jsmol/js/core2.js" />
  	<replace dir="site/jsmol/js" includes="core2.js" token="Clazz." value="Clazz_"/>
  	<replace dir="site/jsmol/js" includes="core2.js" token="($fz = " value=""/>
  	<replace dir="site/jsmol/js" includes="core2.js" token=", $fz.isPrivate = true, $fz)" value=""/> 	
   	<concat destfile="site/jsmol/js/core${call-core.name}.js"><filelist dir="site/jsmol/js" files="
   		core/coretop2.js
   		core2.js
   		core/corebottom2.js
   		" />
   	</concat>
   	<java jar="jars/closure_compiler.jar" fork="true" dir="site/jsmol/js" failonerror="false">
   		<arg line="--js core${call-core.name}.js --js_output_file ../j2s/core/core${call-core.name}.z.js" />
    </java>
  </target>

  <target name="call-min" id="call-min">
   	<echo>Creating JSmol.${call-min.minname}.js</echo> 	
   	<concat destfile="site/jsmol/js/JSmol.${call-min.fullname}.js">
   		<filelist dir="jsmoljs" files="${call-min.list}" />
   	</concat>   
   	<java jar="jars/closure_compiler.jar" fork="true" dir="" failonerror="false">
   		<arg line="--js site/jsmol/js/JSmol.${call-min.fullname}.js --js_output_file site/jsmol/JSmol.${call-min.minname}.js" />
    </java>
  </target>
	


	
</project>
